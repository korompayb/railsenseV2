<!DOCTYPE html>
<html lang="hu" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RailSense Átkelés-figyelő rendszer</title>
    <meta name="theme-color" content="#1e1e1e">
    <link rel="manifest" href="{{ manifest_url }}" />
    <link rel="icon" href="https://apiv2.phntm.hu/favicon.ico">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<style>
    .stops-line::before {
        content: '';
        position: absolute;
        top: 15px;
        left: 11px;
        width: 8px;
        height: 105%;
        z-index: 1;
    }
</style>

<body>

    <main>
        <div class="container" id="content-container">
            <header class="header sticky-top border-bottom" id="myHeader">

                <div class="row">
                    <div class="col-sm-11">
                        <br>
                        <h1 id="welcome"></h1>

                        <h3
                            class="swipeable-box {% if result_status == 1 %}box-red{% elif result_status == 2 or result_status == 4 %}box-green {% elif result_status == 3 %}box-orange{% endif %}">
                            {% if result_status == 1 %}Az átkelés veszélyes!{% elif result_status == 2 or result_status
                            ==
                            4%}Az átkelés biztonságos!{% elif result_status == 3 %}Kiszolgálóhiba: 500{% endif %} <a 
                                href="{{ url_for('search') }}" class="btn btn-outline-light ms-3 justify-content-md-end"
                                aria-pressed="false"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                                    <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"/>
                                  </svg> Térkép</a></h3>
                        <h6 id="date"></h6>
                        <h2
                            class="swipeable-box {% if result_status == 1 %}box-red{% elif result_status == 2 or result_status == 4 %}box-green {% elif result_status == 3 %}box-orange{% endif %}">
                            {{message}}</h2>

                        <!--button class="btn btn-outline-light ms-3" id="dark-mode-toggle" data-bs-toggle="button" aria-pressed="false">Mód</button--><br>

                    </div>

                </div>
            </header>
            <br>
            <div>
                <div>
                    {% for train in trainsdata %}
                    <div class="card" style="max-width: 30rem;">
                        <div style="padding: 0px; overflow: hidden;" class="card-header">
                            <div style="float: left; padding: 13px;">
                                <p id="description" class="card-title text-light">{{ train.description }}</p>
                                <h4 id="headsign" class="card-subtitle" style="margin-bottom: 0px; margin-top: 5px;">{{ train.headsign }} felé</h4>
                            </div>
                            <div class="viszonylatdoboz d-flex justify-content-center align-items-center"
                                style="float: right; padding: 10px; border-top-right-radius: 5px; background-color:#{{ train.color }} !important; width: 90px; height: 85px;">
                                <span style=" font-weight: bold ;color: #{{ train.text_color }};">{{ train.short_name }}</span>
                            </div>
                            <script>
                                document.addEventListener('DOMContentLoaded', function() {
                                    function applyMarquee(element) {
                                        if (element.scrollWidth > element.clientWidth) {
                                            var container = document.createElement('div');
                                            container.className = 'marquee-container';
                                            var marquee = document.createElement('div');
                                            marquee.className = 'marquee';
                                            marquee.innerHTML = element.innerHTML;
                                            container.appendChild(marquee);
                                            element.innerHTML = '';
                                            element.appendChild(container);
                                        }
                                    }
                            
                                    var description = document.getElementById('description');
                                    var headsign = document.getElementById('headsign');
                            
                                    applyMarquee(description);
                                    applyMarquee(headsign);
                                });
                            </script>
                            
                        </div>
                        <div class="card-body text-light"
                            style="border-bottom: var(--bs-card-border-width) solid var();">

                            <div class="accordion accordion" id="accordionExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}"
                                            aria-expanded="false" aria-controls="collapse{{ loop.index }}"
                                            data-index="{{ loop.index }}">
                                            Menetrend
                                        </button>
                                    </h2>
                                    <div id="collapse{{ loop.index }}" class="accordion-collapse collapse"
                                        data-bs-parent="#accordionExample">
                                        <div class="accordion-body">
                                            <table id="menetrend">
                                                <tr>
                                                    <th>Megállók</th>
                                                    <th>Érkezik</th>
                                                </tr>
                                                {% for stop in train.trip_details %}

                                                <tr>
                                                    <td class="stops-line">
                                                        <!-- colored circle -->
                                                        <span class="circle-icon"
                                                            style="border-color: #{{train.color}} !important;"></span>
                                                        {{ stop.stop_name }}
                                                    <td>{{ stop.arrival_time }}</td>

                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="card-footer" style="background-color: var(--primary-color); vertical-align: top;">
                            <div class="rounded"
                                style="padding: 5px; vertical-align: middle; width: fit-content; border: 1px solid;">
                                <div
                                    style="vertical-align: middle; box-sizing: border-box; display: flex; flex-direction: row;">
                                    <svg class="svgtime"
                                        style="box-sizing: border-box; overflow: scroll; background-color: transparent;"
                                        class="svgdoboz2" width="22" height="22" viewBox="0 0 22 19"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.0791 18.7334C10.292 18.7334 11.4697 18.4873 12.5508 18.0303C12.1377 17.582 11.8213 17.0547 11.5928 16.4922C10.8105 16.7822 9.9668 16.9492 9.0791 16.9492C5.03613 16.9492 1.79297 13.6973 1.79297 9.6543C1.79297 5.61133 5.02734 2.36816 9.07031 2.36816C12.7266 2.36816 15.7412 5.04004 16.2686 8.54688C16.8135 8.45898 17.5342 8.48535 18.0879 8.62598C17.5693 4.12598 13.6934 0.575195 9.07031 0.575195C4.0957 0.575195 0 4.68848 0 9.6543C0 14.6289 4.10449 18.7334 9.0791 18.7334ZM4.63184 10.7441H9.07031C9.46582 10.7441 9.76465 10.4365 9.76465 10.0498V4.28418C9.76465 3.89746 9.46582 3.58984 9.07031 3.58984C8.68359 3.58984 8.37598 3.89746 8.37598 4.28418V9.35547H4.63184C4.23633 9.35547 3.9375 9.6543 3.9375 10.0498C3.9375 10.4365 4.23633 10.7441 4.63184 10.7441ZM16.875 18.7773C19.3359 18.7773 21.4014 16.7207 21.4014 14.251C21.4014 11.7725 19.3535 9.7334 16.875 9.7334C14.3965 9.7334 12.3486 11.7725 12.3486 14.251C12.3486 16.7383 14.3965 18.7773 16.875 18.7773ZM16.3477 16.9229C16.1807 16.9229 15.9785 16.8525 15.8467 16.7119L14.1943 14.9014C14.1064 14.8135 14.0449 14.6377 14.0449 14.4883C14.0449 14.1104 14.335 13.8643 14.6689 13.8643C14.8711 13.8643 15.0293 13.9434 15.1436 14.0664L16.3125 15.3496L18.5537 12.2295C18.6768 12.0713 18.8613 11.957 19.0811 11.957C19.4238 11.957 19.7139 12.2295 19.7139 12.5811C19.7139 12.6865 19.6699 12.8271 19.582 12.9414L16.8662 16.6855C16.7607 16.8262 16.5586 16.9229 16.3477 16.9229Z" />
                                    </svg>
                                    <span style="padding-left: 5px !important;"> Érkezik: <b>{{
                                            train.predicted_arrival_time }}</b></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    {% endfor %}











                    <div class="card swipeable-box {% if result_status == 1 %}box-red{% elif result_status == 2 or result_status == 4 %}box-green {% elif result_status == 3 %}box-orange{% endif %}"
                        style="max-width: 30rem;">
                        <div style="padding: 0px; overflow: hidden;" class="card-header">
                            <div style="float: left; padding: 13px;">
                                <p class="card-title text-light">Időjárás</p>
                                <h4 class="card-subtitle swipeable-box {% if result_status == 1 %}box-red{% elif result_status == 2 or result_status == 4 %}box-green {% elif result_status == 3 %}box-orange{% endif %}"
                                    style="margin-bottom: 0px;margin-top: 5px;" id="location-name">
                                    {{address}}
                                </h4>
                            </div>
                            <div class="svgdoboz img-fluid swipeable-box {% if result_status == 1 %}box-red{% elif result_status == 2 or result_status == 4 %}box-green {% elif result_status == 3 %}box-orange{% endif %}"
                                style="float: right; padding: 10px; border-top-right-radius: 5px;">
                                <img src="https://openweathermap.org/img/wn/{{ weather_data.icon_code }}@2x.png"
                                    alt="Weather Icon" style="width: 65px; height: 70;"></img>
                            </div>
                        </div>
                        <div class="card-body text-light"
                            style="border-bottom: var(--bs-card-border-width) solid var();">
                            <span id="weather-data">
                                {% if weather_data.temperature >= 0 and weather_data.temperature <= 16 %} <h4
                                    style="color: rgba(0, 0, 255, 0.496)">{{ weather_data.temperature }}&deg;C</h4>
                                    {% elif weather_data.temperature >= 17 and weather_data.temperature <= 30 %} <h4
                                        style="color: #ffa600a3">{{ weather_data.temperature }}&deg;C</h4>
                                        {% elif weather_data.temperature >= 31 %}
                                        <h4 style="color: #ff000068">{{ weather_data.temperature }}&deg;C</h4>
                                        {% endif %}
                            </span>
                            <span id="wind">
                                {% if weather_data.wind_speed >= 0 and weather_data.wind_speed <= 21 %} <h4
                                    style="color: #008000a6">{{ weather_data.wind_speed | round(2) }} km/h</h4>
                                    {% elif weather_data.wind_speed >= 22 and weather_data.wind_speed <= 23 %} <h4
                                        style="color: #ffa600a3">{{ weather_data.wind_speed | round(2) }} km/h</h4>
                                        {% elif weather_data.wind_speed >= 24 %}
                                        <h4 style="color: #ff00008b">{{ weather_data.wind_speed | round(2) }} km/h</h4>
                                        {% endif %}
                            </span>
                            <p>{{ weather_data.description }}</p>
                        </div>
                        <div class="card-footer" style="background-color: var(--primary-color); vertical-align: top;">
                            <div class="rounded"
                                style="padding: 5px; vertical-align: middle; width: fit-content; border: 1px solid;">
                                <div
                                    style="vertical-align: middle; box-sizing: border-box; display: flex; flex-direction: row;">
                                    <svg class="svgtime"
                                        style="box-sizing: border-box; overflow: scroll; background-color: transparent;"
                                        class="svgdoboz2" width="22" height="22" viewBox="0 0 22 19"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M9.0791 18.7334C10.292 18.7334 11.4697 18.4873 12.5508 18.0303C12.1377 17.582 11.8213 17.0547 11.5928 16.4922C10.8105 16.7822 9.9668 16.9492 9.0791 16.9492C5.03613 16.9492 1.79297 13.6973 1.79297 9.6543C1.79297 5.61133 5.02734 2.36816 9.07031 2.36816C12.7266 2.36816 15.7412 5.04004 16.2686 8.54688C16.8135 8.45898 17.5342 8.48535 18.0879 8.62598C17.5693 4.12598 13.6934 0.575195 9.07031 0.575195C4.0957 0.575195 0 4.68848 0 9.6543C0 14.6289 4.10449 18.7334 9.0791 18.7334ZM4.63184 10.7441H9.07031C9.46582 10.7441 9.76465 10.4365 9.76465 10.0498V4.28418C9.76465 3.89746 9.46582 3.58984 9.07031 3.58984C8.68359 3.58984 8.37598 3.89746 8.37598 4.28418V9.35547H4.63184C4.23633 9.35547 3.9375 9.6543 3.9375 10.0498C3.9375 10.4365 4.23633 10.7441 4.63184 10.7441ZM16.875 18.7773C19.3359 18.7773 21.4014 16.7207 21.4014 14.251C21.4014 11.7725 19.3535 9.7334 16.875 9.7334C14.3965 9.7334 12.3486 11.7725 12.3486 14.251C12.3486 16.7383 14.3965 18.7773 16.875 18.7773ZM16.3477 16.9229C16.1807 16.9229 15.9785 16.8525 15.8467 16.7119L14.1943 14.9014C14.1064 14.8135 14.0449 14.6377 14.0449 14.4883C14.0449 14.1104 14.335 13.8643 14.6689 13.8643C14.8711 13.8643 15.0293 13.9434 15.1436 14.0664L16.3125 15.3496L18.5537 12.2295C18.6768 12.0713 18.8613 11.957 19.0811 11.957C19.4238 11.957 19.7139 12.2295 19.7139 12.5811C19.7139 12.6865 19.6699 12.8271 19.582 12.9414L16.8662 16.6855C16.7607 16.8262 16.5586 16.9229 16.3477 16.9229Z" />
                                    </svg>
                                    <span style="padding-left: 5px !important;"> Most frissült</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br>

    </main>

    <script>window.onscroll = function () { myFunction() };

        var header = document.getElementById("myHeader");
        var sticky = header.offsetTop;

        function myFunction() {
            if (window.pageYOffset > sticky) {
                header.classList.add("sticky");
            } else {
                header.classList.remove("sticky");
            }
        }</script>

    <script>
        /* global bootstrap: false */
        (function () {
            'use strict'
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl)
            })
        })()


        // Amikor az akkordion elem megnyílik
        $(".accordion-button").on("click", function () {
            var index = $(this).data("index");
            localStorage.setItem("activeAccordionIndex", index);
        });

        // Az oldal betöltődésekor
        $(document).ready(function () {
            var activeIndex = localStorage.getItem("activeAccordionIndex");
            if (activeIndex !== null) {
                $("#collapse" + activeIndex).collapse("show");
            }
        });

    </script>
   

   


    <script>

        const openButton = document.querySelector("[data-open-modal]")
        const closeButton = document.querySelector("[data-close-modal]")
        const modal = document.querySelector("[data-modal]")

        openButton.addEventListener("click", () => {
            modal.showModal()
        })


    </script>


<script>
    // Az oldal betöltése után végrehajtandó kód
    document.addEventListener("DOMContentLoaded", function () {
        // Az idő és a köszöntés beállítása
        updateDateTime();
        
        // Az idő és a köszöntés frissítése minden másodpercben
        setInterval(updateDateTime, 3000);
        
        // AJAX kérés indítása 10 másodpercenként
        setInterval(function () {
            // XMLHttpRequest objektum létrehozása
            var xhr = new XMLHttpRequest();
            
            // AJAX kérés konfigurálása
            xhr.open('GET', '/railsense', true);
            
            // AJAX kérés sikerességének kezelése
            xhr.onload = function () {
                // Ellenőrizzük a válasz státuszát
                if (xhr.status >= 200 && xhr.status < 300) {
                    // A válasz feldolgozása
                    var response = xhr.responseText;
                    
                    // A konténer elem tartalmának frissítése
                    document.getElementById('content-container').innerHTML = response;
                } else {
                    // Hibakezelés, ha a szerver hibát ad vissza
                    console.error('Hiba történt az AJAX kérés során: ' + xhr.status);
                }
            };
            
            // Hibakezelés a hálózati problémák esetén
            xhr.onerror = function () {
                console.error('Hálózati hiba történt az AJAX kérés során.');
            };
            
            // AJAX kérés küldése
            xhr.send();
        }, 30000); // 10 másodpercenkénti frissítés
    });
    
    // Az idő és a köszöntés frissítése
    function updateDateTime() {
        // Jelenlegi dátum és idő lekérdezése
        var currentDate = new Date();
            var options = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' };
            var formattedDate = currentDate.toLocaleDateString('hu-HU', options);

            // datum kiiras
            var dateElement = document.getElementById('date');
            dateElement.innerHTML = formattedDate;

            // udvozlo uzenet az idotol fuggoen
            var welcomeElement = document.getElementById('welcome');
            var currentHour = currentDate.getHours();
            var welcomeMessage = '';
        
        // Idő és dátum megjelenítése az oldalon
        document.getElementById('date').innerText = formattedDate;
        document.getElementById('welcome').innerText = getWelcomeMessage(currentDate.getHours());
    }
    
    // Köszöntés üzenet kiválasztása az aktuális órától függően
    function getWelcomeMessage(currentHour) {
        if (currentHour >= 5 && currentHour < 12) {
            return 'Jó reggelt!';
        } else if (currentHour >= 12 && currentHour < 18) {
            return 'Szép napot!';
        } else {
            return 'Jó estét!';
        }
    }
</script>





    <script src="/service-worker.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(function (registration) {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(function (error) {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

    </script>

    <script>const darkModeToggle = document.getElementById('dark-mode-toggle');
        const body = document.body;
        const allElements = document.querySelectorAll('*');

        darkModeToggle.addEventListener('click', () => {
            const isDarkMode = body.classList.toggle('dark-mode');

            allElements.forEach(element => {
                if (isDarkMode) {
                    element.classList.add('dark-mode');
                } else {
                    element.classList.remove('dark-mode');
                }
            });

            localStorage.setItem('darkMode', isDarkMode);
        });

        // Check for dark mode preference from local storage on page load
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            body.classList.add('dark-mode');
            allElements.forEach(element => {
                element.classList.add('dark-mode');
            });
        }</script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // jelenlegi datum
            var currentDate = new Date();
            var options = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' };
            var formattedDate = currentDate.toLocaleDateString('hu-HU', options);

            // datum kiiras
            var dateElement = document.getElementById('date');
            dateElement.innerHTML = formattedDate;

            // udvozlo uzenet az idotol fuggoen
            var welcomeElement = document.getElementById('welcome');
            var currentHour = currentDate.getHours();
            var welcomeMessage = '';

            if (currentHour >= 5 && currentHour < 12) {
                welcomeMessage = 'Jó reggelt!';
            } else if (currentHour >= 12 && currentHour < 18) {
                welcomeMessage = 'Szép napot!';
            } else {
                welcomeMessage = 'Jó estét!';
            }

            welcomeElement.innerHTML = welcomeMessage;


        });

        var swipeableBox = document.getElementById('swipeable-box');
        swipeableBox.addEventListener('click', function () {
            swipeableBox.classList.toggle('expanded');
        });
    </script>

</body>

</html>